https://blog.csdn.net/baidu_32045201/article/details/78305586
# 交换机与路由器
## 区别

路由器工作在OSI的第三层（网络层），而交换机在第二层工作（链路层）
![](https://gitee.com/super-jimwang/img/raw/master/img/20210330095126.png)

它们的主要工作如下：
- 路由器：寻址，转发（依靠 ==IP== 地址）
- 交换机：过滤，转发（依靠 ==MAC== 地址）

路由器内有一份路由表，里面有它的寻址信息（就像是一张地图），它收到网络层的数据报后，会根据路由表和选路算法将数据报转发到下一站（可能是路由器、交换机、目的主机）

交换机内有一张MAC表，里面存放着和它相连的所有设备的MAC地址，它会根据收到的数据帧的首部信息内的目的MAC地址在自己的表中查找，如果有就转发，如果没有就放弃

![](https://gitee.com/super-jimwang/img/raw/master/img/20210330095239.png)

通过拓扑图我们应该知道：

每一个路由器与其之下连接的设备，其实构成一个局域网

交换机工作在路由器之下，就是也就是交换机工作在局域网内

交换机用于局域网内网的数据转发

路由器用于连接局域网和外网

举个例子：
- 我们每个人相当于主机，路由器相当于快递员，宿管大爷相当于交换机，学校是一个局域网
快递员根据学校地址（IP）把包裹送到学校，再根据公寓号（子网IP）把快递交给这个公寓的宿管大爷，宿管大爷根据你的名字（MAC）交给你

## 实际网络数据转发的过程

![](https://gitee.com/super-jimwang/img/raw/master/img/20210330095338.png)

你的电脑先在应用层打包一个 HTTP报文，然后在传输层在打包成 TCP报文，然后再根据 DNS 查到的 IP 在网络层打包成 IP数据报，然后在通过链路层打包成以太网数据帧，发送给你的交换机：

![](https://gitee.com/super-jimwang/img/raw/master/img/20210330095351.png)

你的交换机收到后，重新包装数据帧，再发送给你的路由器：

![](https://gitee.com/super-jimwang/img/raw/master/img/20210330095435.png)

==注意，这里的数据帧的目的地和源地址都变了==

你的路由器利用 NAT(Network Address Translation)，将你的主机IP（局域网IP）转换为外网IP，还会修改端口号，对外完全隐藏你的主机，再根据路由表选择一条合适的路径进行转发：

![](https://gitee.com/super-jimwang/img/raw/master/img/20210330095529.png)

在接下来的过程中，每个节点都只改变 MAC 地址，然后在网络中一路向着目的地发送

> 什么是外网ip和内网IP？

公网ip具有世界范围的唯一性，而内网ip只在局域网内部具有唯一性。

在局域网中，每台电脑都可以自己分配自己的IP，但是这个IP只在局域网中有效。而如果你将电脑连接到互联网，你的网络提供商的服务器会为你分配一个IP地址，这个IP地址才是你在外网的IP。两个IP同时存在，一个对内，一个对外。

即互联网，局域网通过一台服务器或是一个路由器对外连接的网络，这个IP地址是惟一的。也就是说内网里所有的计算机都是连接到这一个外网IP上，通过这一个外网IP对外进行交换数据的。==一个外网IP对应了一个路由器，路由器下的所有计算机使用同一个外网IP，但是它们的内网IP不同==

> 讲一下NAT

NAT不仅能解决IP地址不足的问题，而且还能够有效地避免来自网络外部的攻击，隐藏并保护网络内部的计算机。

NAT的实现方式有三种，即静态转换Static Nat、动态转换Dynamic Nat和端口多路复用OverLoad。
- 静态转换是指将内部网络的私有IP地址转换为公有IP地址，IP地址对是一对一的，是一成不变的，某个私有IP地址只转换为某个公有IP地址。
- 动态转换是指将内部网络的私有IP地址转换为公用IP地址时，IP地址是不确定的，是随机的，所有被授权访问上Internet的私有IP地址可随机转换为任何指定的合法IP地址。
- 端口多路复用（Port address Translation,PAT）是指改变外出数据包的源端口并进行端口转换，即端口地址转换（PAT，Port Address Translation).采用端口多路复用方式。内部网络的所有主机均可共享一个合法外部IP地址实现对Internet的访问，从而可以最大限度地节约IP地址资源。==多台电脑公用一个外网IP，用端口号来进行区分==